{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Feed</h3>
  {% if user.is_authenticated %}
    <a class="btn btn-primary" href="/post/new/">Subir foto</a>
  {% endif %}
</div>

{% for p in posts %}
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <strong>@{{ p.author.username }}</strong>
      {% if user.is_authenticated and user.username != p.author.username %}
        <a class="btn btn-sm btn-outline-secondary" href="/user/{{ p.author.username }}/follow/">
          Seguir / Dejar de seguir
        </a>
      {% endif %}
    </div>

    {% if p.image %}
      <img src="{{ p.image.url }}" class="card-img-top" alt="post de {{ p.author.username }}">
      <small class="text-muted d-block mt-1">URL: {{ p.image.url }}</small>
    {% endif %}

    <div class="card-body">
      <p class="mb-2">{{ p.caption }}</p>

      {% if user.is_authenticated %}
        <a class="btn btn-sm btn-outline-danger" href="/post/{{ p.id }}/like/">
          ❤️ {{ p.likes_count }}
        </a>

        <form method="post" action="/post/{{ p.id }}/comment/" class="mt-3">
          {% csrf_token %}
          <div class="input-group">
            <input name="text" class="form-control" placeholder="Escribe un comentario...">
            <button class="btn btn-outline-primary btn-sm">Comentar</button>
          </div>
        </form>
      {% endif %}

      <div class="mt-3">
        {% for c in p.comments.all %}
          <div><strong>@{{ c.user.username }}:</strong> {{ c.text }}</div>
        {% empty %}
          <div class="text-muted">Sé el primero en comentar.</div>
        {% endfor %}
      </div>
    </div>
  </div>
{% empty %}
  <p class="text-muted">No hay publicaciones todavía. ¡Sube la primera!</p>
{% endfor %}
{% endblock %}
